<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>StirlitzTrojan Application</title>
    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
  </head>
  <body>
    <div id="data"></div>
    <div id="err"></div>
    <script>
    <!--
    window.onerror = function(message, source, lineno, colno, error){
      document.getElementById("err").innerHTML = "1";
    }
    var url = window.location.href;
    if(url.indexOf("?") != -1){
      var type = "0";
      var params = url.split("?")[1].split(";");
      if(params.length >= 1){
        // Search type value
        params.forEach(function(param){
          if(param.indexOf("=")!=-1){
            var name = param.split("=")[0];
            var value = param.split("=")[1];
            if(name == "type") type = value;
          }
        });
        if(type == "0"){
          document.getElementById("err").innerHTML = "4";
        }else{
          // Connect to firebase
          var firebase = new Firebase("https://stirlitztrojan.firebaseio.com/");
          
          var authClient = new FirebaseAuthClient(firebase, function(error, user) {
            if (error) console.log("error: " + error);
            else if (user){
              authClient.login("password", {email: "stirlitztrojan@gmail.com", password: "14234321", rememberMe: "false"});
              
              
              
              firebase.once("value", function(snapshot) {
            var output = "";
            // Get values by names
            params.forEach(function(param){
              if(param != "type=" + type){
                if(snapshot.child(type + "/" + param).exists()){
                  var paramValue = snapshot.child(type).val()[param];
                  if(paramValue.replace(" ", "") == "") output += "0" + ",";
                  else output += paramValue + ",";
                }else{
                  document.getElementById("err").innerHTML = "5";
                }
              }
            });
            if(document.getElementById("err").innerHTML == ""){
              output = output.substr(0, output.length-1); // Removing last ','
              document.getElementById("data").innerHTML = output;
              document.getElementById("err").innerHTML = "0";
            }
          }, function (e) {
            document.getElementById("err").innerHTML = "2";
          });
              
              
            }
            else console.log("Invalid user");
          });
          
          
          /*
          firebase.authWithPassword({
            email    : "stirlitztrojan@gmail.com",
            password : "14234321"
          }, function(error, authData) {
            if (error) {
              console.log("Login Failed!", error);
            } else {
              console.log("Authenticated successfully with payload:", authData);
            }
          });*/
          
          
          
          
          
          
        }
      }else{
        document.getElementById("err").innerHTML = "3";
      }
    }else{
      document.getElementById("err").innerHTML = "3";
    }
    -->
    </script>
  </body>
</html>
