<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="firebase.js"></script>
    <script src="firebase-auth-client.js"></script>
    <script src="jquery-1.12.3.js"></script>
  </head>
  <body>
    <div id="dialog-login" title="Login user">
        <form>
            <fieldset>
                <label for="name">Email</label>
                <input type="text" name="email" id="login-email" class="text ui-widget-content ui-corner-all" />
                <label for="password">Password</label>
                <input type="password" name="password" id="login-password" value="" class="text ui-widget-content ui-corner-all" />
            </fieldset>
        </form>
    </div>
    <button id="opener-login">Login</button>
    <button id="opener-logout">Login</button>
    <br />
    <input id="data" />
    <script>
    // this is derived from
    // http://stackoverflow.com/questions/15167981/how-do-i-use-firebase-simple-login-with-email-password/15167983#15167983
    
    
    // CHANGE THIS to your own firebase
    var ref = new Firebase("https://stirlitztrojan.firebaseio.com");
    // then go to your firebase console, click the auth tab, scroll down to 
    // authentication providers, and enable 'email/password'
    // Now enter this in the 'Auth' tab to the left.
    /*
    {
      "rules": {
        "users": {
          "$userid": {
            ".read": "auth.id == $userid",
            ".write": "auth.id == $userid"
          }
        }
      }
    }
    */
    //
    
    // global user (is this a good thing?)
    myUser = -1;
    
    $(function () {
        $("#dialog-login").dialog({
            autoOpen: false,
            buttons: {
                "ok": function () {
                    console.log('trying to login: ' + $("#login-email").val());
    
                    var email = $("#login-email").val();
                    var password = $("#login-password").val();
    
                    doLogin(email, password);
                    $(this).dialog("close");
                },
                Cancel: function () {
                    $(this).dialog("close");
                }
            }
        });
        $("#opener-login").click(function () {
            $("#dialog-login").dialog("open");
        });
        $("#opener-logout").click(function () {
            authClient.logout();
        });
    });
    function doLogin(email, password) {
        authClient.login('password', {
            email: email,
            password: password
        });
    };
    var authClient = new FirebaseAuthClient(ref, function (error, user) {
        if (error) {
            alert(error);
            return;
        }
        if (user) {
            console.log('User ID: ' + user.id + ', Provider: ' + user.provider);
            console.log('logged in')
        } else {
            console.log('logged out');
        }
    });
    </script>
</body>
</html>
